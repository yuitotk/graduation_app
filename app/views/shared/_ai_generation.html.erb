<style>
  #ai-post { display: none; }
  #ai-post:target { display: block; }
</style>

<div id="ai-post" style="margin: 12px 0;">
  <p><a href="#">AI作成フォームを閉じる</a></p>

  <% if RandomWord.count < 2 %>
    <p>辞書ワードが2件未満です。seedを追加してください。</p>
  <% else %>
    <% random_sql =
      if ActiveRecord::Base.connection.adapter_name.downcase.include?("mysql")
        "RAND()"
      else
        "RANDOM()"
      end
    %>

    <% words = RandomWord.order(Arel.sql(random_sql)).limit(2) %>

    <p><%= words[0].word %></p>
    <p><%= words[1].word %></p>

    <div id="ai_error" style="color: red;"></div>
    <div id="ai_result"></div>

    <%= form_with url: ai_generations_path, method: :post, data: { turbo_stream: true } do |f| %>
      <%= hidden_field_tag :word1, words[0].word %>
      <%= hidden_field_tag :word2, words[1].word %>

      <%# ✅ ホームからは必ず /ideas に戻す（sessionの残り香を上書き） %>
      <%= hidden_field_tag :return_to, (local_assigns[:return_to] || ideas_path) %>
      <%= hidden_field_tag :placeable_type, local_assigns[:placeable_type] %>
      <%= hidden_field_tag :placeable_id, local_assigns[:placeable_id] %>

      <%= f.submit "AIで生成する", data: { disable_with: "生成中..." } %>
    <% end %>
  <% end %>
</div>
